<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>RepariFy Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
    <style>
        body { font-family: 'Poppins', sans-serif; background: #f8f9fa; padding-bottom: 90px; }
        .dashboard-container { max-width: 1200px; margin: auto; }
        .nav-tabs .nav-link.active { font-weight: 600; }
        .table-responsive { max-height: 450px; overflow-y: auto; }
        .btn-actions > button { margin-right: 4px; margin-bottom: 4px; }
        .footer-disclaimer { position: fixed; bottom: 0; left: 0; width: 100%; background-color: #f8d7da; color: #721c24; text-align: center; padding: 5px 10px; font-size: 12px; z-index: 99; }
        .powered-by { font-size: 10px; color: #888; text-align: center; margin-top: 50px; }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
  <div class="container-fluid d-flex justify-content-between">
    <a class="navbar-brand" href="#">RepariFy Dashboard</a>
    <button id="logoutBtn" class="btn btn-outline-light btn-sm">Logout</button>
  </div>
</nav>

<div class="container dashboard-container mt-3">
  <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="mobile-tab" data-bs-toggle="tab" data-bs-target="#mobile" type="button" role="tab">Mobile Repair</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="computer-tab" data-bs-toggle="tab" data-bs-target="#computer" type="button" role="tab">Computer Repair</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="unlocking-tab" data-bs-toggle="tab" data-bs-target="#unlocking" type="button" role="tab">Unlocking Declaration</button>
    </li>
  </ul>
  <div class="tab-content mt-3">
    <!-- Mobile Repair Tab -->
    <div class="tab-pane fade show active" id="mobile" role="tabpanel" aria-labelledby="mobile-tab">
      <h4>New Mobile Repair Job</h4>
      <form id="mobileJobForm">
        <div class="mb-3">
          <input type="text" id="mCustomerName" class="form-control" placeholder="Customer Name" required />
        </div>
        <div class="mb-3">
          <input type="tel" id="mCustomerMobile" class="form-control" placeholder="Mobile No (WhatsApp)" required />
        </div>
        <div class="mb-3">
          <input type="text" id="mDeviceModel" class="form-control" placeholder="Device Model" required />
        </div>
        <div class="mb-3">
          <input type="text" id="mImei" class="form-control" placeholder="IMEI Number (15 digits)" maxlength="15" required />
        </div>
        <div class="mb-3">
          <textarea id="mIssueDesc" class="form-control" placeholder="Issue Description" rows="2" required></textarea>
        </div>
        <div class="mb-3">
          <input type="number" id="mEstimatePrice" class="form-control" placeholder="Estimate Repair Price (₹)" min="0" value="0" required />
        </div>
        <button type="submit" class="btn btn-primary w-100">Create Mobile Job & Generate Bill</button>
      </form>
    </div>
    <!-- Computer Repair Tab -->
    <div class="tab-pane fade" id="computer" role="tabpanel" aria-labelledby="computer-tab">
      <h4>New Computer Repair Job</h4>
      <form id="computerJobForm">
        <div class="mb-3">
          <input type="text" id="cCustomerName" class="form-control" placeholder="Customer Name" required />
        </div>
        <div class="mb-3">
          <input type="tel" id="cCustomerMobile" class="form-control" placeholder="Mobile No (WhatsApp)" required />
        </div>
        <div class="mb-3">
          <input type="text" id="cDeviceBrand" class="form-control" placeholder="Device Brand (e.g. Dell, HP)" required />
        </div>
        <div class="mb-3">
          <input type="text" id="cDeviceModel" class="form-control" placeholder="Model Number" required />
        </div>
        <div class="mb-3">
          <textarea id="cIssueDesc" class="form-control" placeholder="Issue Description" rows="2" required></textarea>
        </div>
        <div class="mb-3">
          <input type="number" id="cEstimatePrice" class="form-control" placeholder="Estimate Repair Price (₹)" min="0" value="0" required />
        </div>
        <button type="submit" class="btn btn-primary w-100">Create Computer Job & Generate Bill</button>
      </form>
    </div>
    <!-- Unlocking Declaration Tab -->
    <div class="tab-pane fade" id="unlocking" role="tabpanel" aria-labelledby="unlocking-tab">
      <h4>Mobile Unlocking Service Declaration</h4>
      <form id="unlockingForm">
        <div class="mb-2">
          <label>Shop Name: <span id="unlockShopName" class="fw-bold"></span></label>
        </div>
        <div class="mb-3">
          <label>Shop Address: <span id="unlockShopAddress"></span></label>
        </div>
        <div class="mb-3">
          <label>Contact Number: <span id="unlockShopContact"></span></label>
        </div>
        <div class="mb-3">
          <label>Brand & Model:</label>
          <input type="text" id="uBrandModel" class="form-control" required />
        </div>
        <div class="mb-3">
          <label>IMEI Number:</label>
          <input type="text" id="uImei" class="form-control" maxlength="15" required />
        </div>
        <label>Type of Unlocking Required:</label>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="unlockPin" />
          <label class="form-check-label" for="unlockPin">Pattern/PIN Unlock</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="unlockFrp" />
          <label class="form-check-label" for="unlockFrp">FRP (Google Account) Unlock</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="unlockNetwork" />
          <label class="form-check-label" for="unlockNetwork">Network Unlock</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="unlockOthers" />
          <label class="form-check-label" for="unlockOthers">Others</label>
        </div>
        <div class="mb-3 mt-3">
          <label>Full Name:</label>
          <input type="text" id="uFullName" class="form-control" required />
        </div>
        <div class="mb-3">
          <label>Address:</label>
          <textarea id="uAddress" class="form-control" rows="2" required></textarea>
        </div>
        <div class="mb-3">
          <label>Phone Number:</label>
          <input type="tel" id="uPhoneNumber" class="form-control" required />
        </div>
        <div class="mb-3">
          <label>ID Type & Number:</label>
          <input type="text" id="uIdTypeNumber" class="form-control" required />
        </div>
        <div class="mb-3">
          <label>Date:</label>
          <input type="date" id="uDate" class="form-control" required />
        </div>
        <div class="mb-3">
          <label>Customer Signature (Enter Name):</label>
          <input type="text" id="uCustomerSignature" class="form-control" required />
        </div>
        <button type="submit" class="btn btn-danger w-100">Create Unlocking Declaration & Generate PDF</button>
      </form>
    </div>
  </div>

  <!-- Recent Jobs Table -->
  <h4 class="mt-4">Recent Jobs / Search By IMEI</h4>
  <div class="table-responsive">
    <table class="table table-striped table-hover" id="jobsTable">
      <thead>
        <tr>
          <th>Job ID</th>
          <th>Device Type</th>
          <th>Customer Name</th>
          <th>Mobile No.</th>
          <th>Device Model</th>
          <th>Estimate (₹)</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="jobs-table-body">
        <tr><td colspan="8" class="text-center text-muted">Loading recent jobs...</td></tr>
      </tbody>
    </table>
  </div>
</div>
<div class="footer-disclaimer">
    ***IMPORTANT: Any unauthorized unlocking, or billing, is the sole responsibility of the shop owner, not the platform.***
</div>
<div class="powered-by">Powered by reparify.com</div>

<!-- Modal: Edit Job -->
<div class="modal fade" id="editJobModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <form class="modal-content" id="editJobForm">
      <div class="modal-header">
        <h5 class="modal-title">Update Job & Finalize Bill</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editJobId" />
        <div class="mb-3"><label>Device Type</label><input type="text" id="editDeviceType" class="form-control" readonly /></div>
        <div class="mb-3"><label>Device Model</label><input type="text" id="editDeviceName" class="form-control" required /></div>
        <div class="mb-3"><label>Issue</label><textarea id="editIssueDescription" class="form-control" rows="2" required></textarea></div>
        <div class="mb-3"><label>Estimate (₹)</label><input type="number" id="editEstimatePrice" class="form-control" min="0" readonly /></div>
        <div class="mb-3"><label>Service Charge (₹)</label><input type="number" id="editServiceCharge" class="form-control" min="0" value="0" /></div>
        <div class="mb-3"><label>Amount Paid (₹)</label><input type="number" id="editPaidAmount" class="form-control" min="0" value="0" /></div>
        <div class="mb-3"><label>Status</label>
            <select id="editCurrentStatus" class="form-select" required>
                <option value="Received">Received</option>
                <option value="InProgress">In Progress</option>
                <option value="PartsWaiting">Parts Waiting</option>
                <option value="Ready">Ready</option>
                <option value="Delivered">Delivered</option>
                <option value="NotRepaired">Not Repaired</option>
            </select>
        </div>
        <div class="mb-3 d-flex justify-content-between align-items-center">
            <h6>Parts Used (Final Bill)</h6>
            <button type="button" class="btn btn-outline-info btn-sm" id="managePartsBtn" data-bs-toggle="modal" data-bs-target="#partsModal">Add/View Parts</button>
        </div>
        <div id="partsContainer" class="border p-2 rounded"></div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Save Changes</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </form>
  </div>
</div>
<!-- Modal: Manage Parts -->
<div class="modal fade" id="partsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Manage Parts Used</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addPartForm" class="row g-2 mb-3">
                    <div class="col-md-6"><input type="text" id="partName" class="form-control form-control-sm" placeholder="Part Name" required /></div>
                    <div class="col-md-4"><input type="number" id="partCost" class="form-control form-control-sm" placeholder="Cost (₹)" required min="1" /></div>
                    <div class="col-md-2"><button type="submit" class="btn btn-success btn-sm w-100">Add</button></div>
                </form>
                <ul id="partsList" class="list-group">
                    <li class="list-group-item d-flex justify-content-between align-items-center text-muted">No parts added yet.</li>
                </ul>
                <h6 class="mt-3">Total Parts Cost: ₹<span id="totalPartsCost">0</span></h6>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Done</button>
            </div>
        </div>
    </div>
</div>
<!-- Required CDN JS & Your dashboard.js -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
<script type="module" src="./dashboard.js"></script>
</body>
</html>
